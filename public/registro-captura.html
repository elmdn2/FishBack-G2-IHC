<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Captura - FishBack</title>
    <link rel="stylesheet" href="assets/styles/registro-captura.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <div class="captura-container">
      <a href="../index.html" class="back-button">‚Üê Volver</a>

      <div class="captura-box">
        <div class="captura-form">
          <h2>Registro de Captura</h2>
          <p class="subtitle">Ingresa los datos de tu pesca para mantener la trazabilidad</p>
          
          <form id="capturaForm">
            <div class="form-grid">
              <div class="form-group">
                <label for="especie">Especie</label>
                <input
                  type="text"
                  id="especie"
                  name="especie"
                  placeholder="Ej: Anchoveta, Jurel, Caballa"
                  required
                />
              </div>

              <div class="form-group">
                <label for="cantidad">Cantidad (kg)</label>
                <input
                  type="number"
                  id="cantidad"
                  name="cantidad"
                  placeholder="0.0"
                  min="0.1"
                  step="0.1"
                  required
                />
              </div>

              <div class="form-group">
                <label for="zona">Zona de Pesca</label>
                <input
                  type="text"
                  id="zona"
                  name="zona"
                  placeholder="Ej: Callao, Pucusana, Chimbote"
                  required
                />
              </div>

              <div class="form-group">
                <label for="fecha">Fecha de Captura</label>
                <input
                  type="date"
                  id="fecha"
                  name="fecha"
                  required
                />
              </div>

              <div class="form-group full-width">
                <label for="observaciones">Observaciones (opcional)</label>
                <textarea
                  id="observaciones"
                  name="observaciones"
                  placeholder="Condiciones del mar, m√©todo de pesca, estado del producto..."
                  rows="4"
                ></textarea>
              </div>
            </div>

            <div class="file-upload-wrapper">
                <button type="button" class="file-btn">Agregar im√°genes</button>
                <input type="file" class="file-input" multiple accept="image/*" />
                <div class="file-preview"></div>
                <div class="file-names">Ning√∫n archivo seleccionado</div>
            </div>

            <button type="submit" class="captura-btn">Guardar Captura</button>
          </form>

          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-icon">üêü</div>
              <p class="stat-label">Trazabilidad completa</p>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚úì</div>
              <p class="stat-label">Registro verificado</p>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <p class="stat-label">Datos transparentes</p>
            </div>
          </div>

          <div class="info-panel">
            <p><strong>Nota:</strong> La informaci√≥n registrada ser√° visible para compradores verificados y contribuye a la trazabilidad del producto marino.</p>
          </div>
        </div>


      </div>
    </div>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("capturaForm");
  const fechaInput = document.getElementById("fecha");
  
  // Establecer fecha actual por defecto
  const hoy = new Date().toISOString().split('T')[0];
  fechaInput.value = hoy;
  fechaInput.max = hoy;

  // --- Archivo e im√°genes ---
  const fileInput = document.querySelector('.file-input');
  const fileBtn = document.querySelector('.file-btn');
  const filePreview = document.querySelector('.file-preview');
  const fileNames = document.querySelector('.file-names');

  fileBtn.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    filePreview.innerHTML = '';
    
    if (fileInput.files.length === 0) {
      fileNames.textContent = "Ning√∫n archivo seleccionado";
      return;
    }

    const filesArray = Array.from(fileInput.files);
    fileNames.textContent = `${filesArray.length} archivo(s) seleccionado(s)`;

    filesArray.forEach((file) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';

        const img = document.createElement('img');
        img.src = e.target.result;

        const descInput = document.createElement('input');
        descInput.type = 'text';
        descInput.placeholder = 'Descripci√≥n (m√°x 15 palabras)';
        descInput.maxLength = 100; // aprox. 15 palabras

        previewItem.appendChild(img);
        previewItem.appendChild(descInput);
        filePreview.appendChild(previewItem);
      };
      reader.readAsDataURL(file);
    });
  });

  // --- Env√≠o del formulario ---
  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const especie = document.getElementById("especie").value.trim();
    const cantidad = document.getElementById("cantidad").value.trim();
    const zona = document.getElementById("zona").value.trim();
    const fecha = document.getElementById("fecha").value;
    const observaciones = document.getElementById("observaciones").value.trim();

    if (!especie || !cantidad || !zona || !fecha) {
      alert("Por favor, complete todos los campos obligatorios.");
      return;
    }

    if (parseFloat(cantidad) <= 0) {
      alert("La cantidad debe ser mayor a 0 kg.");
      return;
    }

    // Obtener descripciones de las im√°genes
    const previews = document.querySelectorAll('.preview-item input');
    const imagenes = Array.from(previews).map((input, index) => ({
      archivo: fileInput.files[index].name,
      descripcion: input.value.trim()
    }));

    // Simular guardado exitoso
    let mensaje = `‚úì Captura registrada exitosamente\n\nEspecie: ${especie}\nCantidad: ${cantidad} kg\nZona: ${zona}\nFecha: ${fecha}`;
    if (imagenes.length > 0) {
      mensaje += `\n\nIm√°genes:\n` + imagenes.map(img => `- ${img.archivo}${img.descripcion ? ' (' + img.descripcion + ')' : ''}`).join('\n');
    }

    alert(mensaje);

    // Limpiar formulario
window.location.href = "punto-venta.html";
  });
});
</script>
</body>
</html>