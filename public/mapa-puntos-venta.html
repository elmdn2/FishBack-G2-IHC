<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa de Puntos de Venta - FishBack</title>
    <link rel="stylesheet" href="assets/styles/mapa-puntos-venta.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Alerta de Vedas -->
    <div class="veda-alert" id="veda-alert">
      <div class="veda-content">
        <i class='bx bx-error-circle'></i>
        <div class="veda-text">
          <strong>ALERTA DE VEDA:</strong>
          <span>Anchoveta en veda hasta el 15/01/2026 | Merluza en veda hasta el 28/02/2026</span>
        </div>
        <button class="close-veda" id="close-veda">
          <i class='bx bx-x'></i>
        </button>
      </div>
    </div>

    <div class="mapa-container">
      <a href="../index.html" class="back-button">← Volver al inicio</a>

      <!-- Panel de búsqueda -->
      <div class="search-panel">
        <div class="search-header">
          <h2><i class='bx bx-map'></i> Mapa de Puntos de Venta</h2>
          <p class="search-subtitle">Encuentra pescadores cerca de ti</p>
        </div>

        <div class="search-box">
          <div class="search-input-wrapper">
            <i class='bx bx-search'></i>
            <input 
              type="text" 
              id="search-input" 
              placeholder="Buscar por especie (ej: mero, concha de abanico, jurel...)"
            />
            <button id="clear-search" class="clear-btn" style="display: none;">
              <i class='bx bx-x'></i>
            </button>
          </div>
          <button id="search-btn" class="search-btn">
            <i class='bx bx-search-alt'></i>
            Buscar
          </button>
        </div>

        <div class="filter-chips">
          <button class="chip active" data-filter="all">
            <i class='bx bx-globe'></i> Todos
          </button>
          <button class="chip" data-filter="cerca">
            <i class='bx bx-current-location'></i> Cerca de mí
          </button>
          <button class="chip" data-filter="abierto">
            <i class='bx bx-time-five'></i> Abierto ahora
          </button>
        </div>
      </div>

      <!-- Área principal -->
      <div class="main-content">
        <!-- Mapa -->
        <div class="map-area">
          <div class="map-placeholder">

            <!-- Imagen del mapa (estática) -->
            <img src="assets/images/mapa.png" class="map-image" alt="Mapa FishBack">

            <!-- Controles del mapa -->
            <div class="map-controls">
              <button class="map-control-btn" title="Centrar en mi ubicación">
                <i class='bx bx-current-location'></i>
              </button>
              <button class="map-control-btn" title="Zoom in">
                <i class='bx bx-plus'></i>
              </button>
              <button class="map-control-btn" title="Zoom out">
                <i class='bx bx-minus'></i>
              </button>
            </div>

            <!-- Marcadores en el mapa -->
            <div class="marker marker-1" data-id="1">
              <i class='bx bxs-map-pin'></i>
            </div>
            <div class="marker marker-2" data-id="2">
              <i class='bx bxs-map-pin'></i>
            </div>
            <div class="marker marker-3" data-id="3">
              <i class='bx bxs-map-pin'></i>
            </div>
            <div class="marker marker-4" data-id="4">
              <i class='bx bxs-map-pin'></i>
            </div>

            <div class="map-legend">
              <div class="legend-item">
                <i class='bx bxs-map-pin' style="color: #6BBF59;"></i>
                <span>Abierto</span>
              </div>
              <div class="legend-item">
                <i class='bx bxs-map-pin' style="color: #F5A623;"></i>
                <span>Cerrado</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de resultados -->
        <div class="results-panel">
          <div class="results-header">
            <h3>Puntos de Venta <span id="results-count">(4)</span></h3>
          </div>

          <div class="results-list" id="results-list">
            <!-- Card 1 -->
            <div class="vendor-card" data-id="1" data-especies="anchoveta,bonito,jurel">
              <div class="card-header">
                <div class="vendor-info">
                  <h4>Juan Pérez Castro</h4>
                  <div class="vendor-rating">
                    <i class='bx bxs-star'></i>
                    <span>4.8</span>
                  </div>
                </div>
                <div class="status-badge open">
                  <i class='bx bx-time-five'></i>
                  Abierto
                </div>
              </div>
              
              <div class="card-body">
                <div class="info-row">
                  <i class='bx bx-map-pin'></i>
                  <span>Terminal Pesquero de Callao, Callao</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-time'></i>
                  <span>06:00 - 14:00 | L-S</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-package'></i>
                  <span>Anchoveta, Bonito, Jurel</span>
                </div>
                <div class="info-row distance">
                  <i class='bx bx-map'></i>
                  <span>1.2 km de distancia</span>
                </div>
              </div>

              <div class="card-actions">
                <button class="action-btn secondary view-btn" data-id="1">
                  <i class='bx bx-show'></i>
                  Ver detalles
                </button>
                <button class="action-btn primary contact-btn" data-id="1">
                  <i class='bx bx-phone'></i>
                  Contactar
                </button>
              </div>
            </div>

            <!-- Card 2 -->
            <div class="vendor-card" data-id="2" data-especies="mero,corvina,lenguado">
              <div class="card-header">
                <div class="vendor-info">
                  <h4>María González Ramos</h4>
                  <div class="vendor-rating">
                    <i class='bx bxs-star'></i>
                    <span>4.9</span>
                  </div>
                </div>
                <div class="status-badge open">
                  <i class='bx bx-time-five'></i>
                  Abierto
                </div>
              </div>
              
              <div class="card-body">
                <div class="info-row">
                  <i class='bx bx-map-pin'></i>
                  <span>Muelle Pucusana, Pucusana</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-time'></i>
                  <span>05:00 - 13:00 | L-D</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-package'></i>
                  <span>Mero, Corvina, Lenguado</span>
                </div>
                <div class="info-row distance">
                  <i class='bx bx-map'></i>
                  <span>3.5 km de distancia</span>
                </div>
              </div>

              <div class="card-actions">
                <button class="action-btn secondary view-btn" data-id="2">
                  <i class='bx bx-show'></i>
                  Ver detalles
                </button>
                <button class="action-btn primary contact-btn" data-id="2">
                  <i class='bx bx-phone'></i>
                  Contactar
                </button>
              </div>
            </div>

            <!-- Card 3 -->
            <div class="vendor-card" data-id="3" data-especies="concha de abanico,calamar,pulpo">
              <div class="card-header">
                <div class="vendor-info">
                  <h4>Carlos Mendoza Ríos</h4>
                  <div class="vendor-rating">
                    <i class='bx bxs-star'></i>
                    <span>4.7</span>
                  </div>
                </div>
                <div class="status-badge closed">
                  <i class='bx bx-time-five'></i>
                  Cerrado
                </div>
              </div>
              
              <div class="card-body">
                <div class="info-row">
                  <i class='bx bx-map-pin'></i>
                  <span>Mercado Central, Chorrillos</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-time'></i>
                  <span>07:00 - 15:00 | L-V</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-package'></i>
                  <span>Concha de abanico, Calamar, Pulpo</span>
                </div>
                <div class="info-row distance">
                  <i class='bx bx-map'></i>
                  <span>5.8 km de distancia</span>
                </div>
              </div>

              <div class="card-actions">
                <button class="action-btn secondary view-btn" data-id="3">
                  <i class='bx bx-show'></i>
                  Ver detalles
                </button>
                <button class="action-btn primary contact-btn" data-id="3">
                  <i class='bx bx-phone'></i>
                  Contactar
                </button>
              </div>
            </div>

            <!-- Card 4 -->
            <div class="vendor-card" data-id="4" data-especies="caballa,perico,atún">
              <div class="card-header">
                <div class="vendor-info">
                  <h4>Roberto Silva Torres</h4>
                  <div class="vendor-rating">
                    <i class='bx bxs-star'></i>
                    <span>4.6</span>
                  </div>
                </div>
                <div class="status-badge open">
                  <i class='bx bx-time-five'></i>
                  Abierto
                </div>
              </div>
              
              <div class="card-body">
                <div class="info-row">
                  <i class='bx bx-map-pin'></i>
                  <span>Puerto Ancón, Ancón</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-time'></i>
                  <span>06:00 - 12:00 | L-S</span>
                </div>
                <div class="info-row">
                  <i class='bx bx-package'></i>
                  <span>Caballa, Perico, Atún</span>
                </div>
                <div class="info-row distance">
                  <i class='bx bx-map'></i>
                  <span>8.2 km de distancia</span>
                </div>
              </div>

              <div class="card-actions">
                <button class="action-btn secondary view-btn" data-id="4">
                  <i class='bx bx-show'></i>
                  Ver detalles
                </button>
                <button class="action-btn primary contact-btn" data-id="4">
                  <i class='bx bx-phone'></i>
                  Contactar
                </button>
              </div>
            </div>
          </div>

          <div class="no-results" id="no-results" style="display: none;">
            <i class='bx bx-search-alt-2'></i>
            <p>No se encontraron pescadores con "<span id="search-term"></span>"</p>
            <button class="reset-btn" id="reset-search">Limpiar búsqueda</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de detalles -->
    <div class="modal" id="details-modal">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h3>Detalles del Pescador</h3>
          <button class="close-modal" id="close-details">
            <i class='bx bx-x'></i>
          </button>
        </div>
        <div class="modal-body" id="modal-details-body">
          <!-- Contenido dinámico -->
        </div>
      </div>
    </div>

    <!-- Modal de contacto -->
    <div class="modal" id="contact-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Contactar Pescador</h3>
          <button class="close-modal" id="close-contact">
            <i class='bx bx-x'></i>
          </button>
        </div>
        <div class="modal-body" id="modal-contact-body">
          <!-- Contenido dinámico -->
        </div>
      </div>
    </div>

    <script>
      // Datos de pescadores
      const pescadores = {
        1: {
          nombre: "Juan Pérez Castro",
          direccion: "Terminal Pesquero de Callao, Callao",
          horario: "06:00 - 14:00",
          dias: "L-S",
          productos: "Anchoveta, Bonito, Jurel",
          telefono: "987 654 321",
          email: "juan.perez@fishback.com",
          descripcion: "Pescador artesanal con 15 años de experiencia. Venta al por mayor y menor.",
          calificacion: "4.8",
          resenas: [
            { autor: "Carlos Rojas", estrellas: 5, fecha: "15/11/2024", comentario: "Excelente pescador, producto fresco y precio justo. Muy recomendable." },
            { autor: "Ana María López", estrellas: 5, fecha: "10/11/2024", comentario: "Siempre tiene el mejor pescado. Muy puntual y confiable." },
            { autor: "Pedro Sánchez", estrellas: 4, fecha: "05/11/2024", comentario: "Buen servicio, aunque a veces se queda sin stock temprano." },
            { autor: "Lucía Torres", estrellas: 5, fecha: "28/10/2024", comentario: "Gran calidad y atención. Es mi proveedor de confianza." },
            { autor: "Miguel Vargas", estrellas: 4, fecha: "20/10/2024", comentario: "Producto de calidad, precios competitivos." }
          ]
        },
        2: {
          nombre: "María González Ramos",
          direccion: "Muelle Pucusana, Pucusana",
          horario: "05:00 - 13:00",
          dias: "L-D",
          productos: "Mero, Corvina, Lenguado",
          telefono: "965 432 198",
          email: "maria.gonzalez@fishback.com",
          descripcion: "Especializada en pesca fina. Producto fresco garantizado.",
          calificacion: "4.9",
          resenas: [
            { autor: "Roberto Castro", estrellas: 5, fecha: "18/11/2024", comentario: "La mejor pescadora de la zona. Siempre trae pescado de primera." },
            { autor: "Diana Flores", estrellas: 5, fecha: "12/11/2024", comentario: "Increíble calidad en sus productos. Muy profesional." },
            { autor: "Jorge Méndez", estrellas: 5, fecha: "08/11/2024", comentario: "Excelente servicio y productos fresquísimos." },
            { autor: "Carmen Ríos", estrellas: 4, fecha: "01/11/2024", comentario: "Muy buena, aunque sus precios son un poco altos." }
          ]
        },
        3: {
          nombre: "Carlos Mendoza Ríos",
          direccion: "Mercado Central, Chorrillos",
          horario: "07:00 - 15:00",
          dias: "L-V",
          productos: "Concha de abanico, Calamar, Pulpo",
          telefono: "912 345 678",
          email: "carlos.mendoza@fishback.com",
          descripcion: "Mariscos frescos del día. Precios competitivos.",
          calificacion: "4.7",
          resenas: [
            { autor: "Elena Morales", estrellas: 5, fecha: "16/11/2024", comentario: "Los mejores mariscos que he probado. Todo muy fresco." },
            { autor: "Ricardo Vega", estrellas: 4, fecha: "09/11/2024", comentario: "Buen producto, aunque a veces hay que esperar." },
            { autor: "Sofía Ruiz", estrellas: 5, fecha: "02/11/2024", comentario: "Mariscos de excelente calidad. Lo recomiendo 100%." },
            { autor: "Fernando Díaz", estrellas: 4, fecha: "25/10/2024", comentario: "Buena variedad, precios razonables." },
            { autor: "Patricia Gómez", estrellas: 3, fecha: "18/10/2024", comentario: "Bien, pero he encontrado mejores opciones en otros lugares." }
          ]
        },
        4: {
          nombre: "Roberto Silva Torres",
          direccion: "Puerto Ancón, Ancón",
          horario: "06:00 - 12:00",
          dias: "L-S",
          productos: "Caballa, Perico, Atún",
          telefono: "998 765 432",
          email: "roberto.silva@fishback.com",
          descripcion: "Pesca de altura. Producto de primera calidad.",
          calificacion: "4.6",
          resenas: [
            { autor: "Alberto Ramírez", estrellas: 5, fecha: "14/11/2024", comentario: "Pescado de altura de gran calidad. Muy satisfecho." },
            { autor: "María José Pérez", estrellas: 4, fecha: "07/11/2024", comentario: "Buen pescador, producto fresco. Recomendado." },
            { autor: "Javier Luna", estrellas: 5, fecha: "30/10/2024", comentario: "Excelente atención y producto de primera." },
            { autor: "Claudia Herrera", estrellas: 4, fecha: "22/10/2024", comentario: "Muy buen pescado, aunque los precios varían mucho." },
            { autor: "Andrés Paredes", estrellas: 3, fecha: "15/10/2024", comentario: "Aceptable, pero esperaba mejor calidad por el precio." }
          ]
        }
      };

      // Cerrar alerta de veda
      document.getElementById('close-veda').addEventListener('click', () => {
        document.getElementById('veda-alert').style.display = 'none';
      });

      // Búsqueda
      const searchInput = document.getElementById('search-input');
      const searchBtn = document.getElementById('search-btn');
      const clearSearch = document.getElementById('clear-search');
      const resultsList = document.getElementById('results-list');
      const noResults = document.getElementById('no-results');
      const resultsCount = document.getElementById('results-count');

      searchInput.addEventListener('input', () => {
        clearSearch.style.display = searchInput.value ? 'block' : 'none';
      });

      clearSearch.addEventListener('click', () => {
        searchInput.value = '';
        clearSearch.style.display = 'none';
        resetSearch();
      });

      searchBtn.addEventListener('click', performSearch);
      searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') performSearch();
      });

      function performSearch() {
        const term = searchInput.value.toLowerCase().trim();
        if (!term) return;

        const cards = document.querySelectorAll('.vendor-card');
        let visibleCount = 0;

        cards.forEach(card => {
          const especies = card.dataset.especies.toLowerCase();
          if (especies.includes(term)) {
            card.style.display = 'block';
            visibleCount++;
          } else {
            card.style.display = 'none';
          }
        });

        if (visibleCount === 0) {
          noResults.style.display = 'flex';
          document.getElementById('search-term').textContent = term;
        } else {
          noResults.style.display = 'none';
        }

        resultsCount.textContent = `(${visibleCount})`;
      }

      function resetSearch() {
        const cards = document.querySelectorAll('.vendor-card');
        cards.forEach(card => card.style.display = 'block');
        noResults.style.display = 'none';
        resultsCount.textContent = '(4)';
      }

      document.getElementById('reset-search').addEventListener('click', () => {
        searchInput.value = '';
        clearSearch.style.display = 'none';
        resetSearch();
      });

      // Ver detalles
      const detailsModal = document.getElementById('details-modal');
      const closeDetails = document.getElementById('close-details');
      const viewBtns = document.querySelectorAll('.view-btn');

      viewBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const pescador = pescadores[id];
          
          // Calcular estadísticas de reseñas
          const totalResenas = pescador.resenas.length;
          const estrellasCounts = [0, 0, 0, 0, 0];
          pescador.resenas.forEach(r => estrellasCounts[r.estrellas - 1]++);
          
          document.getElementById('modal-details-body').innerHTML = `
            <div class="detail-section">
              <div class="detail-row">
                <strong>Pescador:</strong>
                <span>${pescador.nombre}</span>
              </div>
              <div class="detail-row">
                <strong>Calificación:</strong>
                <span><i class='bx bxs-star' style="color: #F5A623;"></i> ${pescador.calificacion}/5.0 (${totalResenas} reseñas)</span>
              </div>
              <div class="detail-row">
                <strong>Ubicación:</strong>
                <span>${pescador.direccion}</span>
              </div>
              <div class="detail-row">
                <strong>Horario:</strong>
                <span>${pescador.horario} | ${pescador.dias}</span>
              </div>
              <div class="detail-row">
                <strong>Productos disponibles:</strong>
                <span>${pescador.productos}</span>
              </div>
              <div class="detail-row">
                <strong>Descripción:</strong>
                <span>${pescador.descripcion}</span>
              </div>
            </div>

            <!-- Sección de reseñas -->
            <div class="reviews-section">
              <div class="reviews-header">
                <h4><i class='bx bx-star'></i> Reseñas de Clientes</h4>
                <button class="add-review-btn" onclick="openReviewForm(${id})">
                  <i class='bx bx-plus'></i>
                  Dejar reseña
                </button>
              </div>

              <!-- Estadísticas de estrellas -->
              <div class="rating-stats">
                <div class="rating-overview">
                  <div class="rating-number">${pescador.calificacion}</div>
                  <div class="rating-stars">
                    ${generateStars(parseFloat(pescador.calificacion))}
                  </div>
                  <div class="rating-count">${totalResenas} reseñas</div>
                </div>
                <div class="rating-bars">
                  ${[5, 4, 3, 2, 1].map(star => `
                    <div class="rating-bar-item">
                      <span class="star-label">${star} <i class='bx bxs-star'></i></span>
                      <div class="rating-bar-bg">
                        <div class="rating-bar-fill" style="width: ${(estrellasCounts[star - 1] / totalResenas * 100)}%"></div>
                      </div>
                      <span class="rating-bar-count">${estrellasCounts[star - 1]}</span>
                    </div>
                  `).join('')}
                </div>
              </div>

              <!-- Filtros de estrellas -->
              <div class="review-filters">
                <button class="filter-star-btn active" data-stars="all" onclick="filterReviews(${id}, 'all')">
                  <i class='bx bx-list-ul'></i> Todas
                </button>
                <button class="filter-star-btn" data-stars="5" onclick="filterReviews(${id}, 5)">
                  5 <i class='bx bxs-star'></i>
                </button>
                <button class="filter-star-btn" data-stars="4" onclick="filterReviews(${id}, 4)">
                  4 <i class='bx bxs-star'></i>
                </button>
                <button class="filter-star-btn" data-stars="3" onclick="filterReviews(${id}, 3)">
                  3 <i class='bx bxs-star'></i>
                </button>
                <button class="filter-star-btn" data-stars="2" onclick="filterReviews(${id}, 2)">
                  2 <i class='bx bxs-star'></i>
                </button>
                <button class="filter-star-btn" data-stars="1" onclick="filterReviews(${id}, 1)">
                  1 <i class='bx bxs-star'></i>
                </button>
              </div>

              <!-- Lista de reseñas -->
              <div class="reviews-list" id="reviews-list-${id}">
                ${pescador.resenas.map(resena => `
                  <div class="review-card" data-stars="${resena.estrellas}">
                    <div class="review-header">
                      <div class="review-author">
                        <div class="author-avatar">${resena.autor.charAt(0)}</div>
                        <div class="author-info">
                          <strong>${resena.autor}</strong>
                          <span class="review-date">${resena.fecha}</span>
                        </div>
                      </div>
                      <div class="review-stars">
                        ${generateStars(resena.estrellas)}
                      </div>
                    </div>
                    <p class="review-comment">${resena.comentario}</p>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          
          detailsModal.classList.add('active');
        });
      });

      function generateStars(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
          if (i <= rating) {
            stars += '<i class="bx bxs-star" style="color: #F5A623;"></i>';
          } else if (i - rating < 1) {
            stars += '<i class="bx bxs-star-half" style="color: #F5A623;"></i>';
          } else {
            stars += '<i class="bx bx-star" style="color: #ddd;"></i>';
          }
        }
        return stars;
      }

      function filterReviews(pescadorId, filterStars) {
        const reviewsList = document.getElementById(`reviews-list-${pescadorId}`);
        const reviewCards = reviewsList.querySelectorAll('.review-card');
        
        // Actualizar botones activos
        const filterBtns = document.querySelectorAll('.filter-star-btn');
        filterBtns.forEach(btn => btn.classList.remove('active'));
        event.target.closest('.filter-star-btn').classList.add('active');
        
        // Filtrar reseñas
        reviewCards.forEach(card => {
          if (filterStars === 'all' || parseInt(card.dataset.stars) === filterStars) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      }

      function openReviewForm(pescadorId) {
        const pescador = pescadores[pescadorId];
        
        // Crear modal para agregar reseña
        const formModal = document.createElement('div');
        formModal.className = 'modal active';
        formModal.id = 'review-form-modal';
        formModal.innerHTML = `
          <div class="modal-content">
            <div class="modal-header">
              <h3>Dejar Reseña para ${pescador.nombre}</h3>
              <button class="close-modal" onclick="closeReviewForm()">
                <i class='bx bx-x'></i>
              </button>
            </div>
            <div class="modal-body">
              <form id="review-form" onsubmit="submitReview(event, ${pescadorId})">
                <div class="form-group">
                  <label>Tu nombre</label>
                  <input type="text" id="review-author" required placeholder="Nombre completo">
                </div>
                
                <div class="form-group">
                  <label>Calificación</label>
                  <div class="star-rating-input">
                    <input type="radio" name="rating" value="5" id="star5" required>
                    <label for="star5"><i class='bx bxs-star'></i></label>
                    <input type="radio" name="rating" value="4" id="star4">
                    <label for="star4"><i class='bx bxs-star'></i></label>
                    <input type="radio" name="rating" value="3" id="star3">
                    <label for="star3"><i class='bx bxs-star'></i></label>
                    <input type="radio" name="rating" value="2" id="star2">
                    <label for="star2"><i class='bx bxs-star'></i></label>
                    <input type="radio" name="rating" value="1" id="star1">
                    <label for="star1"><i class='bx bxs-star'></i></label>
                  </div>
                </div>

                <div class="form-group">
                  <label>Tu comentario</label>
                  <textarea id="review-comment" required rows="4" placeholder="Cuéntanos tu experiencia con este pescador..."></textarea>
                </div>

                <button type="submit" class="submit-review-btn">
                  <i class='bx bx-check-circle'></i>
                  Publicar Reseña
                </button>
              </form>
            </div>
          </div>
        `;
        
        document.body.appendChild(formModal);
      }

      function closeReviewForm() {
        const formModal = document.getElementById('review-form-modal');
        if (formModal) formModal.remove();
      }

      function submitReview(event, pescadorId) {
        event.preventDefault();
        
        const autor = document.getElementById('review-author').value;
        const estrellas = parseInt(document.querySelector('input[name="rating"]:checked').value);
        const comentario = document.getElementById('review-comment').value;
        const fecha = new Date().toLocaleDateString('es-PE');
        
        // Agregar reseña al array
        pescadores[pescadorId].resenas.unshift({
          autor,
          estrellas,
          fecha,
          comentario
        });
        
        // Recalcular calificación promedio
        const totalEstrellas = pescadores[pescadorId].resenas.reduce((sum, r) => sum + r.estrellas, 0);
        pescadores[pescadorId].calificacion = (totalEstrellas / pescadores[pescadorId].resenas.length).toFixed(1);
        
        // Cerrar modal de formulario
        closeReviewForm();
        
        // Actualizar modal de detalles
        detailsModal.classList.remove('active');
        setTimeout(() => {
          document.querySelector(`.view-btn[data-id="${pescadorId}"]`).click();
        }, 300);
        
        alert('✓ Reseña publicada exitosamente');
      }

      closeDetails.addEventListener('click', () => {
        detailsModal.classList.remove('active');
      });

      // Contactar
      const contactModal = document.getElementById('contact-modal');
      const closeContact = document.getElementById('close-contact');
      const contactBtns = document.querySelectorAll('.contact-btn');

      contactBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const pescador = pescadores[id];
          
          document.getElementById('modal-contact-body').innerHTML = `
            <div class="contact-options">
              <h4>Elige cómo contactar a ${pescador.nombre}:</h4>
              <a href="tel:${pescador.telefono.replace(/\s/g, '')}" class="contact-option">
                <i class='bx bx-phone'></i>
                <div>
                  <strong>Llamar</strong>
                  <span>${pescador.telefono}</span>
                </div>
              </a>
              <a href="https://wa.me/51${pescador.telefono.replace(/\s/g, '')}" target="_blank" class="contact-option">
                <i class='bx bxl-whatsapp'></i>
                <div>
                  <strong>WhatsApp</strong>
                  <span>${pescador.telefono}</span>
                </div>
              </a>
              <a href="mailto:${pescador.email}" class="contact-option">
                <i class='bx bx-envelope'></i>
                <div>
                  <strong>Correo electrónico</strong>
                  <span>${pescador.email}</span>
                </div>
              </a>
            </div>
          `;
          
          contactModal.classList.add('active');
        });
      });

      closeContact.addEventListener('click', () => {
        contactModal.classList.remove('active');
      });

      // Cerrar modales al hacer click fuera
      window.addEventListener('click', (e) => {
        if (e.target === detailsModal) {
          detailsModal.classList.remove('active');
        }
        if (e.target === contactModal) {
          contactModal.classList.remove('active');
        }
      });

      // Marcadores en el mapa
      const markers = document.querySelectorAll('.marker');
      markers.forEach(marker => {
        marker.addEventListener('click', () => {
          const id = marker.dataset.id;
          const card = document.querySelector(`.vendor-card[data-id="${id}"]`);
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          card.style.animation = 'highlight 1s';
          setTimeout(() => card.style.animation = '', 1000);
        });
      });

      // Filtros
      const chips = document.querySelectorAll('.chip');
      chips.forEach(chip => {
        chip.addEventListener('click', () => {
          chips.forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          // Aquí se implementaría la lógica de filtrado
        });
      });
    </script>
</body>
</html>